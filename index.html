<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            width: 100%;
            max-width: 800px;
        }

        .card-header {
            background: #4a4e69;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .card-header h2 { margin: 0; font-size: 1.8rem; font-weight: 600; }

        .form-section { padding: 30px; }

        /* Floating Label Tweaks */
        .form-floating > label { color: #6c757d; }
        .form-floating > .form-control:focus ~ label { color: #764ba2; }
        .form-control:focus { border-color: #764ba2; box-shadow: 0 0 0 0.25rem rgba(118, 75, 162, 0.25); }

        /* Button Styling */
        .btn-group-nav .btn { border-radius: 0; }
        .btn-group-nav .btn:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        .btn-group-nav .btn:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }

        .action-bar {
            background: #f8f9fa;
            padding: 20px;
            border-top: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-action { min-width: 120px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        /* Status Bar */
        #statusAlert {
            border-radius: 0;
            margin: 0;
            text-align: center;
            font-weight: 600;
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>

<div class="main-card">
    <div class="card-header">
        <h2><i class="fa-solid fa-users-gear me-2"></i>Customer Manager</h2>
        <span id="searchBadge" class="badge mt-2" style="display:none; background-color: #8c32fa; color: white;">SEARCH MODE ACTIVATED!</span>
    </div>

    <div id="statusAlert" class="alert alert-light" role="alert">Loading...</div>

    <form id="customerForm">
        <input type="hidden" id="currentIndex" value="0">
        <input type="hidden" id="currentId" value="">

        <div class="form-section">
            <div class="row g-3 mb-3">
                <div class="col-md-12">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="name" placeholder="Full Name">
                        <label for="name"><i class="fa-solid fa-user me-1"></i> Full Name</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="telno" placeholder="Phone">
                        <label for="telno"><i class="fa-solid fa-phone me-1"></i> Telephone</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="email" placeholder="Email">
                        <label for="email"><i class="fa-solid fa-envelope me-1"></i> Email Address</label>
                    </div>
                </div>
            </div>

            <h6 class="text-muted border-bottom pb-2 mb-3 mt-4">Address Details</h6>

            <div class="row g-3">
                <div class="col-md-12">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="street" placeholder="Street">
                        <label for="street"><i class="fa-solid fa-road me-1"></i> Street Address</label>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="city" placeholder="City">
                        <label for="city">City</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="state" placeholder="State">
                        <label for="state">State</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="zip" placeholder="Zip">
                        <label for="zip">Zip Code</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-center pb-3">
            <div class="btn-group btn-group-nav shadow-sm" role="group">
                <button type="button" class="btn btn-outline-secondary px-4" onclick="navigate('first')"><i class="fa-solid fa-backward-step"></i> First</button>
                <button type="button" class="btn btn-outline-secondary px-4" onclick="navigate('prev')"><i class="fa-solid fa-chevron-left"></i> Prev</button>
                <button type="button" class="btn btn-outline-secondary px-4" onclick="navigate('next')">Next <i class="fa-solid fa-chevron-right"></i></button>
                <button type="button" class="btn btn-outline-secondary px-4" onclick="navigate('last')">Last <i class="fa-solid fa-forward-step"></i></button>
            </div>
        </div>

        <div class="action-bar">
            <button type="button" class="btn btn-success btn-action shadow-sm" onclick="performAction('add')">
                <i class="fa-solid fa-plus-circle"></i> Add New
            </button>
            <button type="button" class="btn btn-primary btn-action shadow-sm" data-bs-toggle="modal" data-bs-target="#searchModal">
                <i class="fa-solid fa-magnifying-glass"></i> Search
            </button>
            <button type="button" class="btn btn-warning text-dark btn-action shadow-sm" onclick="performAction('update')">
                <i class="fa-solid fa-pen-to-square"></i> Update
            </button>
            <button type="button" class="btn btn-danger btn-action shadow-sm" onclick="performAction('delete')">
                <i class="fa-solid fa-trash-can"></i> Delete
            </button>
        </div>
    </form>
</div>

<div class="modal fade" id="searchModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="fa-solid fa-magnifying-glass me-2"></i>Find Customer</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <div class="form-floating">
            <input type="text" id="searchInput" class="form-control" placeholder="Enter Name">
            <label for="searchInput">Enter Customer Name</label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary px-4" onclick="runSearch()">Search</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    
    let searchResults = [];
    let isSearchMode = false;
    let searchPointer = 0;

    $(document).ready(function() {
        navigate('first');
    });

    // Helper to show status
    function showStatus(msg, type) {
        let alertClass = (type === 'error') ? 'alert-danger' : 'alert-success';
        let icon = (type === 'error') ? '<i class="fa-solid fa-triangle-exclamation me-2"></i>' : '<i class="fa-solid fa-check-circle me-2"></i>';
        
        $('#statusAlert')
            .removeClass('alert-danger alert-success alert-light')
            .addClass(alertClass)
            .html(icon + msg)
            .slideDown();
            
        // Auto hide success messages after 3 seconds
        if(type === 'success') {
            setTimeout(() => { $('#statusAlert').slideUp(); }, 3000);
        }
    }

    // --- search logic ---
    function runSearch() {
        let name = $('#searchInput').val();
        $('#searchModal').modal('hide');

        $.ajax({
            url: 'backend.php',
            type: 'POST',
            dataType: 'json',
            data: { action: 'search', name: name },
            success: function(response) {
                if(response.status === 'success') {
                    searchResults = response.foundIndices;
                    isSearchMode = true;
                    searchPointer = 0;
                    
                    $('#searchBadge').fadeIn();
                    populateForm(response.data, response.firstIndex);
                    showStatus(response.message, 'success');
                } else {
                    exitSearchMode();
                    showStatus(response.message, 'error');
                }
            }
        });
    }

    // --- navigation logic ---
    function navigate(direction) {
        if (direction === 'first' || direction === 'last') exitSearchMode();

        if (isSearchMode) {
            if (direction === 'next') {
                if (searchPointer < searchResults.length - 1) searchPointer++;
                else { showStatus("End of search results.", 'error'); return; }
            } else if (direction === 'prev') {
                if (searchPointer > 0) searchPointer--;
                else { showStatus("Start of search results.", 'error'); return; }
            }
            
            let realIndex = searchResults[searchPointer];
            // Fetch specific index using jump trick
            $.ajax({
                url: 'backend.php', type: 'POST', dataType: 'json',
                data: { action: 'navigate', direction: 'jump', currentIndex: realIndex },
                success: function(r){ 
                    populateForm(r.data, r.index); 
                    showStatus("Search Result " + (searchPointer + 1) + " of " + searchResults.length, 'success');
                }
            });

        } else {
            // Normal Navigation
            let index = $('#currentIndex').val();
            $.ajax({
                url: 'backend.php',
                type: 'POST',
                dataType: 'json',
                data: { action: 'navigate', direction: direction, currentIndex: index },
                success: function(response) {
                    if(response.status === 'success') {
                        populateForm(response.data, response.index);
                        $('#statusAlert').text("Viewing Record " + (parseInt(response.index) + 1)).removeClass('alert-danger alert-success').addClass('alert-light').show();
                    } else {
                        showStatus(response.message, 'error');
                    }
                }
            });
        }
    }

    function exitSearchMode() {
        isSearchMode = false;
        searchResults = [];
        $('#searchBadge').fadeOut();
        $('#searchInput').val('');
    }

    function performAction(type) {
        exitSearchMode();
        
        let formData = {
            action: type,
            id: $('#currentId').val(),
            currentIndex: $('#currentIndex').val(),
            name: $('#name').val(),
            telno: $('#telno').val(),
            email: $('#email').val(),
            street: $('#street').val(),
            city: $('#city').val(),
            state: $('#state').val(),
            zip: $('#zip').val()
        };

        if ((type === 'add' || type === 'update') && formData.name === '') {
            showStatus("Name is required!", 'error');
            return;
        }

        $.ajax({
            url: 'backend.php',
            type: 'POST',
            dataType: 'json',
            data: formData,
            success: function(response) {
                if(response.status === 'success') {
                    showStatus(response.message, 'success');
                    if (response.data) populateForm(response.data, response.index);
                    if (type === 'delete') navigate('first');
                } else {
                    showStatus(response.message, 'error');
                }
            }
        });
    }

    function populateForm(data, index) {
        $('#currentIndex').val(index);
        $('#currentId').val(data.id);
        $('#name').val(data.name);
        $('#telno').val(data.telno);
        $('#email').val(data.email);
        $('#street').val(data.street);
        $('#city').val(data.city);
        $('#state').val(data.state);
        $('#zip').val(data.zip);
    }
</script>

</body>
</html>